{% extends "base.twig" %}

{% block title %}{{ item.display_title }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb mb-0">
            <li class="breadcrumb-item"><a href="/items">Items</a></li>
            <li class="breadcrumb-item active">{{ item.display_title }}</li>
        </ol>
    </nav>

    <div class="btn-group">
        {% if user and ((user.usertype >= 1 and item.userid == user.id) or user.isAdmin()) %}
        <a href="/items/{{ item.id }}/edit" class="btn btn-primary">
            <i class="bi bi-pencil me-1"></i>Edit Item
        </a>
        {% endif %}
        <a href="/items" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left me-1"></i>Back to Items
        </a>
    </div>
</div>

<div class="row">
    <!-- Main Information -->
    <div class="col-lg-8 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-laptop me-2"></i>{{ item.display_title }}
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6 class="text-muted mb-3">Basic Information</h6>

                        <div class="mb-3">
                            <label class="form-label fw-bold">Item Type</label>
                            <div>
                                {% if item.itemType %}
                                    <span class="badge bg-info">{{ item.itemType.typedesc }}</span>
                                {% else %}
                                    <span class="text-muted">Not specified</span>
                                {% endif %}
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">Status</label>
                            <div>
                                {% if item.statusType %}
                                    {% set status_class = item.status == 1 ? 'success' : (item.status == 0 ? 'danger' : 'secondary') %}
                                    <span class="badge bg-{{ status_class }}">{{ item.statusType.statusdesc }}</span>
                                {% else %}
                                    <span class="badge bg-secondary">Unknown</span>
                                {% endif %}
                            </div>
                        </div>

                        {% if item.model %}
                        <div class="mb-3">
                            <label class="form-label fw-bold">Model</label>
                            <div>{{ item.model }}</div>
                        </div>
                        {% endif %}

                        {% if item.sn %}
                        <div class="mb-3">
                            <label class="form-label fw-bold">Serial Number</label>
                            <div><code>{{ item.sn }}</code></div>
                        </div>
                        {% endif %}

                        {% if item.label %}
                        <div class="mb-3">
                            <label class="form-label fw-bold">Asset Tag</label>
                            <div><code>{{ item.label }}</code></div>
                        </div>
                        {% endif %}
                    </div>

                    <div class="col-md-6">
                        <h6 class="text-muted mb-3">Assignment & Location</h6>

                        <div class="mb-3">
                            <label class="form-label fw-bold">Assigned To</label>
                            <div>
                                {% if item.user %}
                                    <div class="d-flex align-items-center">
                                        <i class="bi bi-person-circle me-2"></i>
                                        {{ item.user.userdesc|default(item.user.username) }}
                                    </div>
                                {% else %}
                                    <span class="text-muted">Unassigned</span>
                                {% endif %}
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">Location</label>
                            <div>
                                {% if item.location %}
                                    <i class="bi bi-geo-alt me-1"></i>{{ item.location.name }}
                                {% else %}
                                    <span class="text-muted">Not specified</span>
                                {% endif %}
                            </div>
                        </div>

                        {% if item.ipv4 %}
                        <div class="mb-3">
                            <label class="form-label fw-bold">IP Address</label>
                            <div><code>{{ item.ipv4 }}</code></div>
                        </div>
                        {% endif %}

                        {% if item.dnsname %}
                        <div class="mb-3">
                            <label class="form-label fw-bold">DNS Name</label>
                            <div><code>{{ item.dnsname }}</code></div>
                        </div>
                        {% endif %}
                    </div>
                </div>

                {% if item.comments %}
                <hr>
                <div class="mb-0">
                    <label class="form-label fw-bold">Comments</label>
                    <div class="bg-light p-3 rounded">{{ item.comments }}</div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Sidebar Information -->
    <div class="col-lg-4">
        <!-- Warranty Information -->
        <div class="card mb-4">
            <div class="card-header">
                <h6 class="card-title mb-0">
                    <i class="bi bi-shield-check me-2"></i>Warranty Information
                </h6>
            </div>
            <div class="card-body">
                {% if item.purchasedate %}
                <div class="mb-3">
                    <label class="form-label fw-bold">Purchase Date</label>
                    <div>{{ item.purchasedate|date('F j, Y') }}</div>
                </div>
                {% endif %}

                {% if item.warrantymonths %}
                <div class="mb-3">
                    <label class="form-label fw-bold">Warranty Period</label>
                    <div>{{ item.warrantymonths }} months</div>
                </div>

                <div class="mb-0">
                    <label class="form-label fw-bold">Warranty Status</label>
                    <div>
                        {% if item.warranty_status.status == 'active' %}
                            <span class="text-success">
                                <i class="bi bi-shield-check me-1"></i>
                                Active ({{ item.warranty_status.days }} days remaining)
                            </span>
                        {% elseif item.warranty_status.status == 'expired' %}
                            <span class="text-danger">
                                <i class="bi bi-shield-x me-1"></i>Expired
                            </span>
                        {% else %}
                            <span class="text-muted">Unknown</span>
                        {% endif %}
                    </div>
                </div>
                {% else %}
                <div class="text-muted text-center py-3">
                    <i class="bi bi-shield-slash display-6 mb-2"></i>
                    <div>No warranty information available</div>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Hardware Specifications -->
        {% if item.cpu or item.ram or item.hd %}
        <div class="card mb-4">
            <div class="card-header">
                <h6 class="card-title mb-0">
                    <i class="bi bi-cpu me-2"></i>Hardware Specifications
                </h6>
            </div>
            <div class="card-body">
                {% if item.cpu %}
                <div class="mb-2">
                    <label class="form-label fw-bold">CPU</label>
                    <div>{{ item.cpu }}</div>
                </div>
                {% endif %}

                {% if item.ram %}
                <div class="mb-2">
                    <label class="form-label fw-bold">Memory</label>
                    <div>{{ item.ram }}</div>
                </div>
                {% endif %}

                {% if item.hd %}
                <div class="mb-0">
                    <label class="form-label fw-bold">Storage</label>
                    <div>{{ item.hd }}</div>
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}

        <!-- Quick Actions -->
        {% if user and user.isAdmin() %}
        <div class="card">
            <div class="card-header">
                <h6 class="card-title mb-0">
                    <i class="bi bi-gear me-2"></i>Quick Actions
                </h6>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="/items/{{ item.id }}/edit" class="btn btn-outline-primary btn-sm">
                        <i class="bi bi-pencil me-1"></i>Edit Item
                    </a>
                    <button type="button"
                            class="btn btn-outline-danger btn-sm"
                            data-bs-toggle="modal"
                            data-bs-target="#deleteModal">
                        <i class="bi bi-trash me-1"></i>Delete Item
                    </button>
                </div>
            </div>
        </div>

        <!-- Delete Modal -->
        <div class="modal fade" id="deleteModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Confirm Deletion</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <p>Are you sure you want to delete this item?</p>
                        <div class="alert alert-warning">
                            <strong>{{ item.display_title }}</strong>
                            {% if item.model %}<br>Model: {{ item.model }}{% endif %}
                            {% if item.sn %}<br>Serial: {{ item.sn }}{% endif %}
                        </div>
                        <p class="text-danger mb-0">
                            <i class="bi bi-exclamation-triangle me-1"></i>
                            This action cannot be undone.
                        </p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <form method="POST" action="/items/{{ item.id }}/delete" class="d-inline">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                            <button type="submit" class="btn btn-danger">
                                <i class="bi bi-trash me-1"></i>Delete Item
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}